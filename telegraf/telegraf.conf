# Telegraf Configuration
# Bridge entre Artillery (StatsD) y InfluxDB v2

[agent]
  interval = "10s"
  round_interval = true
  metric_batch_size = 1000
  metric_buffer_limit = 10000
  collection_jitter = "0s"
  flush_interval = "10s"
  flush_jitter = "0s"
  precision = ""
  hostname = "telegraf"
  omit_hostname = false

# Input: StatsD (recibe métricas de Artillery)
[[inputs.statsd]]
  protocol = "udp"
  service_address = ":8125"
  delete_gauges = true
  delete_counters = true
  delete_sets = true
  delete_timings = true
  percentiles = [50, 90, 95, 99]
  metric_separator = "."
  parse_data_dog_tags = false
  datadog_extensions = false
  allowed_pending_messages = 10000
  percentile_limit = 1000
  
  # Convertir métricas de Artillery al formato esperado
  templates = [
    "artillery.*.*.* measurement.test.field.metric_type",
    "artillery.*.* measurement.field.metric_type"
  ]

# Output: InfluxDB v2
[[outputs.influxdb_v2]]
  urls = ["${INFLUXDB_URL}"]
  token = "${INFLUXDB_TOKEN}"
  organization = "${INFLUXDB_ORG}"
  bucket = "${INFLUXDB_BUCKET}"
  timeout = "5s"
  user_agent = "telegraf-artillery"
  
  # Etiquetas adicionales para identificar datos de Artillery
  [outputs.influxdb_v2.tagpass]
  
  [outputs.influxdb_v2.tagdrop]
